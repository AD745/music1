import{_ as w,p as B,ad as L,r as c,a3 as F,af as _,ae as N,c as i,o as l,b as s,d as V,a7 as H,F as z,q as D,C as M,a2 as P,v as R}from"./index-OxonDnP-.js";const U={class:"music-player-container"},j={class:"main-content"},A={class:"record-player-section"},G={class:"record-player"},J={class:"record-cover-container"},K=["src"],O={key:0,class:"loading-indicator"},Q={key:1,class:"error-indicator"},W={__name:"player",setup(X){const y=B();L(()=>y.state.isPlaying);const f=L(()=>y.state.currentSong),n=c([]),u=c(0),g=c(null),m=c(!1),p=c(!0);function x(){p.value=!1,m.value=!1}function k(){p.value=!1,m.value=!0}let o=null;const d=()=>{if(!o)return;const t=o.currentTime;for(let e=0;e<n.value.length;e++)if(t>=n.value[e].time&&(e===n.value.length-1||t<n.value[e+1].time)){u.value!==e&&(u.value=e,E());break}},E=()=>{_(()=>{const t=g.value,e=t==null?void 0:t.querySelector(".active");if(t&&e){const r=e.offsetTop-t.offsetHeight/2+e.offsetHeight/2;t.scrollTo({top:r,behavior:"smooth"})}})};F(()=>{_(()=>{o=document.querySelector("audio"),o&&(o.removeEventListener("timeupdate",d),o.addEventListener("timeupdate",d)),h()})}),N(f,()=>{_(()=>{o=document.querySelector("audio"),o&&(o.removeEventListener("timeupdate",d),o.addEventListener("timeupdate",d)),h(),u.value=0})});async function h(){try{const e=await(await fetch(f.value.lyric)).text();n.value=C(e)}catch(t){console.error("歌词加载失败:",t)}}function C(t){const e=t.split(`
`),r=[],v=/\[(\d{2}):(\d{2})(?:\.(\d{2,3}))?\](.*)/;for(const S of e){const a=v.exec(S);if(a){const T=parseInt(a[1]),I=parseInt(a[2]),b=a[3]?parseInt(a[3].padEnd(3,"0")):0,q=T*60+I+b/1e3;r.push({time:q,text:a[4]})}}return r}return(t,e)=>(l(),i("div",U,[s("div",j,[s("div",A,[s("div",G,[s("div",J,[s("img",{src:f.value.cover,alt:"唱片封面",class:"record-cover",onLoad:x,onError:k},null,40,K),p.value?(l(),i("div",O,e[0]||(e[0]=[s("svg",{class:"svgfont"},[s("use",{"xlink:href":"#icon-bofang"})],-1)]))):m.value?(l(),i("div",Q,e[1]||(e[1]=[s("svg",{class:"svgfont"},[s("use",{"xlink:href":"#icon-picture-outline"})],-1),s("div",null,"图片加载失败",-1)]))):H("",!0)]),e[2]||(e[2]=s("div",{class:"record-player-shell"},[s("div",{class:"record-needle"})],-1))])]),s("div",{class:"lyrics",ref_key:"lyricsContainer",ref:g},[(l(!0),i(z,null,D(n.value,(r,v)=>(l(),i("div",{key:v,class:P({active:v===u.value})},R(r.text),3))),128))],512)]),V(M)]))}},Z=w(W,[["__scopeId","data-v-cd805f68"]]);export{Z as default};
