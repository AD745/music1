import{_ as B,p as F,ad as L,r as c,a3 as N,af as y,ae as P,c as i,o as l,b as s,d as V,a7 as H,F as U,q as z,C as D,a2 as M,v as R}from"./index-C_SoqU56.js";const W={class:"music-player-container"},j={class:"main-content"},A={class:"record-player-section"},G={class:"record-player"},J={class:"record-cover-container"},K=["src"],O={key:0,class:"loading-indicator"},Q={key:1,class:"error-indicator"},X={__name:"player",setup(Y){const _=F();function x(t){if(t&&t.startsWith("@/"))try{return"/online-music-space/"+t.replace("@/","")}catch(e){return console.error("图片加载失败:",t,e),""}return t}L(()=>_.state.isPlaying);const f=L(()=>_.state.currentSong),r=c([]),u=c(0),g=c(null),m=c(!1),p=c(!0);function k(){p.value=!1,m.value=!1}function E(){p.value=!1,m.value=!0}let o=null;const d=()=>{if(!o)return;const t=o.currentTime;for(let e=0;e<r.value.length;e++)if(t>=r.value[e].time&&(e===r.value.length-1||t<r.value[e+1].time)){u.value!==e&&(u.value=e,C());break}},C=()=>{y(()=>{const t=g.value,e=t==null?void 0:t.querySelector(".active");if(t&&e){const n=e.offsetTop-t.offsetHeight/2+e.offsetHeight/2;t.scrollTo({top:n,behavior:"smooth"})}})};N(()=>{y(()=>{o=document.querySelector("audio"),o&&(o.removeEventListener("timeupdate",d),o.addEventListener("timeupdate",d)),h()})}),P(f,()=>{y(()=>{o=document.querySelector("audio"),o&&(o.removeEventListener("timeupdate",d),o.addEventListener("timeupdate",d)),h(),u.value=0})});async function h(){try{const e=await(await fetch(f.value.lyric)).text();r.value=I(e)}catch(t){console.error("歌词加载失败:",t)}}function I(t){const e=t.split(`
`),n=[],v=/\[(\d{2}):(\d{2})(?:\.(\d{2,3}))?\](.*)/;for(const S of e){const a=v.exec(S);if(a){const T=parseInt(a[1]),b=parseInt(a[2]),q=a[3]?parseInt(a[3].padEnd(3,"0")):0,w=T*60+b+q/1e3;n.push({time:w,text:a[4]})}}return n}return(t,e)=>(l(),i("div",W,[s("div",j,[s("div",A,[s("div",G,[s("div",J,[s("img",{src:x(f.value.cover),alt:"唱片封面",class:"record-cover",onLoad:k,onError:E},null,40,K),p.value?(l(),i("div",O,e[0]||(e[0]=[s("svg",{class:"svgfont"},[s("use",{"xlink:href":"#icon-bofang"})],-1)]))):m.value?(l(),i("div",Q,e[1]||(e[1]=[s("svg",{class:"svgfont"},[s("use",{"xlink:href":"#icon-picture-outline"})],-1),s("div",null,"图片加载失败",-1)]))):H("",!0)]),e[2]||(e[2]=s("div",{class:"record-player-shell"},[s("div",{class:"record-needle"})],-1))])]),s("div",{class:"lyrics",ref_key:"lyricsContainer",ref:g},[(l(!0),i(U,null,z(r.value,(n,v)=>(l(),i("div",{key:v,class:M({active:v===u.value})},R(n.text),3))),128))],512)]),V(D)]))}},$=B(X,[["__scopeId","data-v-6fd74f67"]]);export{$ as default};
